# ============================================================================
# Brique 42 - Molam Connect Payments
# Environment Configuration
# ============================================================================

# ============================================================================
# Server Configuration
# ============================================================================
NODE_ENV=development
PORT=8042
CORS_ORIGIN=*

# ============================================================================
# Database Configuration (PostgreSQL)
# ============================================================================
DATABASE_URL=postgresql://user:password@localhost:5432/molam_connect_payments

# ============================================================================
# Molam ID Authentication (JWT RS256)
# ============================================================================
# Public key for verifying Molam ID JWT tokens
# Format: RS256 public key with \n for line breaks
MOLAM_ID_JWT_PUBLIC="-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...\n-----END PUBLIC KEY-----"

# ============================================================================
# Integration avec autres briques Molam
# ============================================================================

# Connect Accounts Service (Brique 41)
BRIQUE_41_URL=http://localhost:8041

# Wallet Service (Brique 33)
WALLET_URL=http://localhost:8033

# Treasury Service (Briques 34-35)
TREASURY_URL=http://localhost:8034

# ============================================================================
# Redis Configuration (for SSE broker)
# ============================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# ============================================================================
# Security & Rate Limiting
# ============================================================================
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=800

# ============================================================================
# Workers & Background Jobs
# ============================================================================
# Webhook delivery worker (runs every minute)
# Dispatcher worker (runs every 2 seconds)
# Payout eligibility worker (runs every hour)
# SSE broker worker (runs every second)

# ============================================================================
# Logging & Monitoring
# ============================================================================
LOG_LEVEL=info
SENTRY_DSN=

# ============================================================================
# Feature Flags
# ============================================================================
ENABLE_WEBHOOK_RETRIES=true
ENABLE_SSE_EVENTS=true
ENABLE_SIRA_SCORING=true

# ============================================================================
# SIRA Risk Scoring
# ============================================================================
# External SIRA API URL (if using external service)
SIRA_API_URL=
SIRA_API_KEY=

# Risk thresholds
SIRA_BLOCK_THRESHOLD=0.95
SIRA_HIGH_RISK_THRESHOLD=0.80
SIRA_ELEVATED_RISK_THRESHOLD=0.60

# ============================================================================
# Compliance & Hold Periods
# ============================================================================
# Minimum hold period (days) - enforced at DB level
MIN_HOLD_DAYS=3

# Extra hold days based on risk
HOLD_DAYS_HIGH_RISK=7
HOLD_DAYS_ELEVATED_RISK=3

# ============================================================================
# Development & Testing
# ============================================================================
# Skip JWT verification in development (DANGEROUS - only for local dev)
SKIP_JWT_VERIFICATION=false

# Mock external services (for testing without dependencies)
MOCK_BRIQUE_41=false
MOCK_WALLET_SERVICE=false
MOCK_TREASURY_SERVICE=false
MOCK_SIRA_SERVICE=false
