# ============================================================================
# Brique 45 - Webhooks Industriels
# Environment Configuration
# ============================================================================

# ============================================================================
# Server Configuration
# ============================================================================
NODE_ENV=development
PORT=8045
CORS_ORIGIN=*

# ============================================================================
# Database Configuration (PostgreSQL)
# ============================================================================
DATABASE_URL=postgresql://user:password@localhost:5432/molam_webhooks

# ============================================================================
# Molam ID Authentication (JWT RS256)
# ============================================================================
# Public key for verifying Molam ID JWT tokens
MOLAM_ID_JWT_PUBLIC="-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...\n-----END PUBLIC KEY-----"

# ============================================================================
# KMS/Vault Configuration (Secret Encryption)
# ============================================================================
# For production: use AWS KMS, GCP KMS, HashiCorp Vault
# For development: simple AES-256-GCM with app-level key
VAULT_TYPE=local
VAULT_DATA_KEY=

# Generate: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
# Keep secure, rotate periodically

# ============================================================================
# Webhook Dispatcher Configuration
# ============================================================================
# Worker poll interval (ms)
DISPATCHER_POLL_INTERVAL=1500

# Batch size per tick
DISPATCHER_BATCH_SIZE=50

# Request timeout for webhook delivery (ms)
WEBHOOK_REQUEST_TIMEOUT=10000

# User agent for webhook requests
WEBHOOK_USER_AGENT=Molam-Connect-Webhook/1.0

# ============================================================================
# Retry & DLQ Configuration
# ============================================================================
# Backoff schedule (comma-separated, in milliseconds)
# Default: 1m, 5m, 15m, 1h, 6h, 24h
RETRY_BACKOFF_MS=60000,300000,900000,3600000,21600000,86400000

# Max retries before DLQ (should match backoff length)
MAX_RETRY_ATTEMPTS=6

# ============================================================================
# Security & Rate Limiting
# ============================================================================
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=1000

# Signature timestamp tolerance (ms)
SIGNATURE_TOLERANCE_MS=300000

# ============================================================================
# Logging & Monitoring
# ============================================================================
LOG_LEVEL=info
SENTRY_DSN=

# ============================================================================
# Feature Flags
# ============================================================================
ENABLE_DISPATCHER_WORKER=true
ENABLE_SIGNATURE_VERIFICATION=true

# ============================================================================
# Development & Testing
# ============================================================================
# Skip JWT verification in development (DANGEROUS - only for local dev)
SKIP_JWT_VERIFICATION=false
